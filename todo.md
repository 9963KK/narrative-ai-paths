# TODO 任务清单

## 🚀 当前优先级任务

### ✅ 已完成：API Key记忆功能
- **目标**：避免每次刷新都需要重新输入API Key
- **实现内容**：
  - ✅ 创建配置存储服务 (`src/services/configStorage.ts`)
  - ✅ 添加API Key加密/解密功能
  - ✅ 更新ModelConfig组件支持自动保存/加载
  - ✅ 添加配置状态显示和清除功能
  - ✅ 集成到StoryManager中自动加载保存的配置
  - ✅ 修复配置警告显示逻辑，避免已配置时仍显示警告
  - ✅ 优化清除配置功能：清除时同时清空表单并禁用保存按钮

### 1. 角色系统更新
- **目标**：确保故事进行中的角色信息被正确载入和更新
- **实现细节**：
  - 扩展`StoryState`接口，增加角色动态更新字段
  - 修改`StoryManager`中的角色处理逻辑
  - 添加角色状态持久化功能
- **关联文件**：
  - `src/components/StoryManager.tsx`
  - `src/services/storyAI.ts`

### ✅ 已完成：上下文管理系统升级
- **目标**：实现故事上下文保存和历史对话管理
- **实现内容**：
  - ✅ 创建`contextManager`核心服务 (`src/services/contextManager.ts`)
  - ✅ 设计完整的上下文数据结构和接口
  - ✅ 集成到`StoryManager`组件中
  - ✅ 实现本地存储加密功能
  - ✅ 创建存档管理UI组件 (`src/components/SaveManager.tsx`)
  - ✅ 在`StoryReader`中添加保存和存档管理按钮
  - ✅ 实现自动保存机制（每章节完成后自动保存）
  - ✅ 支持多故事并行管理
  - ✅ 添加存档元数据管理（标题、时间、进度等）
  - ✅ **首页存档管理入口**：在主界面添加存档管理选项
  - ✅ **详细进度显示**：显示章节进度、游戏时长、角色数量
  - ✅ **可视化进度条**：直观显示故事完成度
  - ✅ **三列布局优化**：简单配置、存档管理、高级配置
  - ✅ **首页存档预览**：从首页直接查看和加载所有存档
- **新增功能**：
  - 手动保存故事进度
  - 自动保存在关键节点
  - 存档列表查看和管理
  - 故事进度恢复
  - 对话历史完整保存
  - 🆕 首页存档入口和快速访问
  - 🆕 可视化故事进度展示
  - 🆕 卡片式存档浏览
  - 🆕 一键继续游戏功能

## 📅 基于小说上传功能的开发计划

### 阶段一：文件处理基础设施 (1-2周)
- [ ] 实现文件上传组件 (`FileUploader.tsx`)
- [ ] 开发文件解析服务 (`fileParser.ts`)
- [ ] 创建进度指示器 (`ProgressIndicator.tsx`)

### 阶段二：AI内容分析引擎 (2-3周)
- [ ] 实现角色识别和分析功能
- [ ] 开发故事元素提取逻辑
- [ ] 构建写作风格分析模块

### 阶段三：配置生成和用户界面 (1-2周)
- [ ] 创建分析结果展示组件
- [ ] 开发角色配置编辑器
- [ ] 实现故事模板生成器

### 阶段四：系统集成和优化 (1-2周)
- [ ] 将自定义配置集成到`StoryManager`
- [ ] 实现配置模板管理
- [ ] 优化性能和错误处理

## 🔄 集成任务

### 角色系统与小说分析的整合
- [ ] 使AI生成的角色能无缝融入现有角色系统
- [ ] 确保角色动态更新与小说分析结果同步

### 上下文管理与历史对话
- [ ] 将小说分析上下文纳入全局上下文管理
- [ ] 实现分析历史记录功能

## ⚠️ 注意事项
1. 所有临时测试文件需在测试完成后删除（用户规则）
2. 优先保证现有功能的稳定性
3. 新功能开发需通过单元测试

## 📌 版本规划
- v1.1: 角色系统和上下文管理更新 (2周)
- v1.2: 基础小说上传功能 (4周)
- v1.3: 完整小说分析能力 (6周) 