# TODO 任务清单

## 🚀 当前优先级任务

### ✅ 已完成：API Key记忆功能

- **目标**：避免每次刷新都需要重新输入API Key
- **实现内容**：
  - ✅ 创建配置存储服务 (`src/services/configStorage.ts`)
  - ✅ 添加API Key加密/解密功能
  - ✅ 更新ModelConfig组件支持自动保存/加载
  - ✅ 添加配置状态显示和清除功能
  - ✅ 集成到StoryManager中自动加载保存的配置
  - ✅ 修复配置警告显示逻辑，避免已配置时仍显示警告
  - ✅ 优化清除配置功能：清除时同时清空表单并禁用保存按钮

### 1. 角色系统更新

- **目标**：确保故事进行中的角色信息被正确载入和更新
- **实现细节**：
  - 扩展 `StoryState`接口，增加角色动态更新字段
  - 修改 `StoryManager`中的角色处理逻辑
  - 添加角色状态持久化功能
- **关联文件**：
  - `src/components/StoryManager.tsx`
  - `src/services/storyAI.ts`

### ✅ 已完成：上下文管理系统升级

- **目标**：实现故事上下文保存和历史对话管理
- **实现内容**：
  - ✅ 创建 `contextManager`核心服务 (`src/services/contextManager.ts`)
  - ✅ 设计完整的上下文数据结构和接口
  - ✅ 集成到 `StoryManager`组件中
  - ✅ 实现本地存储加密功能
  - ✅ 创建存档管理UI组件 (`src/components/SaveManager.tsx`)
  - ✅ 在 `StoryReader`中添加保存和存档管理按钮
  - ✅ 实现自动保存机制（每章节完成后自动保存）
  - ✅ 支持多故事并行管理
  - ✅ 添加存档元数据管理（标题、时间、进度等）
  - ✅ **首页存档管理入口**：在主界面添加存档管理选项
  - ✅ **详细进度显示**：显示章节进度、游戏时长、角色数量
  - ✅ **可视化进度条**：直观显示故事完成度
  - ✅ **三列布局优化**：简单配置、存档管理、高级配置
  - ✅ **首页存档预览**：从首页直接查看和加载所有存档
- **新增功能**：
  - 手动保存故事进度
  - 自动保存在关键节点
  - 存档列表查看和管理
  - 故事进度恢复
  - 对话历史完整保存
  - 🆕 首页存档入口和快速访问
  - 🆕 可视化故事进度展示
  - 🆕 卡片式存档浏览
  - 🆕 一键继续游戏功能

## ✅ 已完成：文档分析功能

- **目标**：实现小说文档上传分析，AI提取创作元素
- **实现内容**：
  - ✅ 创建文档分析服务 (`src/services/documentAnalyzer.ts`)
  - ✅ 实现多格式文件支持（TXT、PDF、DOCX、MD、RTF）
  - ✅ AI智能分析：角色识别、背景设定、主题分析、写作风格
  - ✅ 创建文档分析组件 (`src/components/DocumentAnalyzer.tsx`)
  - ✅ 拖拽上传界面和分析结果可视化展示
  - ✅ 集成到故事初始化流程中
  - ✅ 在主页面添加"文档分析"选项卡
  - ✅ 支持基于分析结果自动填充高级配置
  - ✅ 在AI故事生成中集成文档分析参考
  - ✅ 界面布局优化（调整卡片位置顺序）
  - ✅ 高级配置页面滚动体验优化
- **核心功能**：
  - **角色分析**：自动识别人物角色、性格特点、关系网络
  - **背景设定**：提取时间、地点、世界观、氛围
  - **主题元素**：分析故事主题、冲突、情节设备
  - **风格特征**：识别叙述视角、语调、文体风格
  - **创意种子**：生成基于原作的故事创意
- **技术特点**：
  - 支持多种AI模型（OpenAI、Anthropic、DeepSeek等）
  - 3次重试机制确保分析成功率
  - 智能内容截取处理长文档
  - 温度控制保证分析准确性

## 📅 基于小说上传功能的开发计划

### ✅ 阶段一：文件处理基础设施 (已完成)

- [X] 实现文件上传组件（集成在DocumentAnalyzer中）
- [X] 开发文件解析服务 (`documentAnalyzer.ts`)
- [X] 创建进度指示器和状态展示

### ✅ 阶段二：AI内容分析引擎 (已完成)

- [X] 实现角色识别和分析功能
- [X] 开发故事元素提取逻辑
- [X] 构建写作风格分析模块
- [X] 集成多模型AI分析能力

### ✅ 阶段三：配置生成和用户界面 (已完成)

- [X] 创建分析结果展示组件
- [X] 实现自动配置填充功能
- [X] 集成到故事生成流程

### ✅ 阶段四：系统集成和优化 (已完成)

- [X] 将分析结果集成到 `StoryManager`
- [X] 实现分析结果在故事生成中的应用
- [X] 优化界面和用户体验

## 🔮 未来功能增强计划

### 文档分析功能深化

- [ ] 支持更多文件格式（EPUB、MOBI等电子书格式）
- [ ] 实现PDF OCR文字识别能力
- [ ] 添加分析结果导出功能（JSON、PDF报告）
- [ ] 支持批量文档分析
- [ ] 实现分析模板自定义功能

### 高级分析功能

- [ ] 情感分析和情节张力曲线
- [ ] 角色关系网络图生成
- [ ] 写作技巧和文学手法识别
- [ ] 多语言文档分析支持

## 🔄 集成任务

### 角色系统与小说分析的整合

- [ ] 使AI生成的角色能无缝融入现有角色系统
- [ ] 确保角色动态更新与小说分析结果同步

### 上下文管理与历史对话

- [ ] 将小说分析上下文纳入全局上下文管理
- [ ] 实现分析历史记录功能

## ⚠️ 注意事项

1. 所有临时测试文件需在测试完成后删除（用户规则）
2. 优先保证现有功能的稳定性
3. 新功能开发需通过单元测试

## 📌 版本规划

- ✅ v1.1: 角色系统和上下文管理更新 (已完成)
- ✅ v1.2: 基础小说上传功能 (已完成)
- ✅ v1.3: 完整小说分析能力 (已完成)
- 🔄 v1.4: 用户体验优化和高级功能扩展 (进行中)

---

## 📝 个人备注区

> 这里是你的个人想法和备注空间，可以随时记录灵感、问题或改进建议

### 💡 想法收集

- 在文档解析这个模块，现阶段采用的策略是把文本内容全部传送给大模型进行处理，让大模型从这个文本中提取需要的信息，这样的优点是：
  - 传输的上下文完整，能够提取丰富的信息
  - 输入的

### 🐛 发现的问题

### 🚀 改进建议

### 📋 临时记录

---

*最后更新时间：$(date)*
